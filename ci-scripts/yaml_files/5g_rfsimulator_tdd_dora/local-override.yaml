include:
  - ../local_common_overrides/build_images.yaml
  - ../local_common_overrides/rebuild_nr_softmodems.yaml
services:
  oai-gnb:
    privileged: true
    depends_on:
      rebuild-nr-softmodems:
        condition: service_completed_successfully
    environment:
        USE_ADDITIONAL_OPTIONS: --rfsim --do-ra --rfsimulator.wait_timeout 20 --noS1 --log_config.global_log_options level,nocolor,time
        ASAN_OPTIONS: detect_leaks=0
    # volumes:
    # replace the gnb executable here
  oai-nr-ue:
    privileged: true
    image: ue-local
    depends_on:
      build-ran-build:
        condition: service_completed_successfully
        restart: true
      oai-gnb:
        condition: service_started
      rebuild-nr-softmodems:
        condition: service_completed_successfully
    container_name: local-oai-nr-ue
    volumes:
      - ../../../cmake_targets/ran_build/build/nr-uesoftmodem:/opt/oai-nr-ue/bin/nr-uesoftmodem
      - ../../../cmake_targets/ran_build/build/librfsimulator.so:/usr/local/lib/librfsimulator.so 
      - ../../../crashdumps/:/cores/
    environment:
      USE_ADDITIONAL_OPTIONS: --rfsim --do-ra --noS1 --reconfig-file etc/rrc/reconfig.raw --rbconfig-file etc/rrc/rbconfig.raw --rfsimulator.serveraddr 192.168.71.140 --log_config.global_log_options level,nocolor,time --num-ues 2
      ASAN_OPTIONS: detect_leaks=0
